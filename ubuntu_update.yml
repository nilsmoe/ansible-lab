# Updating and patcinig Ubuntu servers
# Usage: ansible-playbook -i hosts ubuntu_update.yml 
---
- hosts: ubuntu
  become: yes
  tasks:
    - name: Update apt cache
      apt: update_cache=yes cache_valid_time=3600

    - name: Upgrade all packages
      apt: upgrade=dist
      when: ansible_distribution == "Ubuntu"

    - name: Install security updates
      apt: upgrade=security
      when: ansible_distribution == "Ubuntu"

    - name: reboot the server if a restart is required by apt
      ansible.builtin.reboot:
      when: reboot_required_file.stat.exists == true
        
    - name: Remove dependency packages no longer required
      ansible.builtin.apt:
      autoremove: yes
      when: ansible_distribution == "Ubuntu"``